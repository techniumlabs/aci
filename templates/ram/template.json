{
    "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "location": {
            "defaultValue": "westeurope",
            "type": "string"
        },
        "virtualNetworks_aci_test_name": {
            "defaultValue": "aci-test",
            "type": "String"
        },
        "storageAccounts_acistoragetest_name": {
            "defaultValue": "acistoragetest",
            "type": "String"
        },
        "storageAccounts_acistoragetest1_name": {
            "defaultValue": "acistoragetest1",
            "type": "String"
        },
        "containerGroups_wordpress_app_name": {
            "defaultValue": "wordpress-app",
            "type": "String"
        },
        "subnets_app_subnet_name": {
            "defaultValue": "app-subnet",
            "type": "String"
        }
    },
    "variables": {},
    "resources": [
        {
            "type": "Microsoft.ContainerInstance/containerGroups",
            "name": "[parameters('containerGroups_wordpress_app_name')]",
            "apiVersion": "2018-04-01",
            "location": "[parameters('location')]",
            "scale": null,
            "properties": {
                "containers": [
                    {
                        "name": "wordpress",
                        "properties": {
                            "image": "wordpress:4.9-apache",
                            "ports": [
                                {
                                    "protocol": "TCP",
                                    "port": 80
                                }
                            ],
                            "environmentVariables": [
                                {
                                    "name": "WORDPRESS_DB_PASSWORD",
                                    "value": "password"
                                },
                                {
                                    "name": "WORDPRESS_DB_HOST",
                                    "value": "127.0.0.1:3306"
                                },
                                {
                                    "name": "WORDPRESS_DEBUG",
                                    "value": "1"
                                }
                            ],
                            "resources": {
                                "requests": {
                                    "memoryInGB": 1.5,
                                    "cpu": 1
                                }
                            },
                            "volumeMounts": [
                                {
                                    "name": "wordpressfile",
                                    "mountPath": "/var/www/html"
                                }
                            ]
                        }
                    },
                    {
                        "name": "wordpress-db",
                        "properties": {
                            "image": "mysql:5.6",
                            "ports": [
                                {
                                    "protocol": "TCP",
                                    "port": 3306
                                }
                            ],
                            "environmentVariables": [
                                {
                                    "name": "MYSQL_ROOT_PASSWORD",
                                    "value": "password"
                                },
                                {
                                    "name": "MYSQL_DATABASE",
                                    "value": "wordpress"
                                }
                            ],
                            "resources": {
                                "requests": {
                                    "memoryInGB": 1.5,
                                    "cpu": 1
                                }
                            },
                            "volumeMounts": [
                                {
                                    "name": "mysqlfile",
                                    "mountPath": "/var/lib/mysql"
                                }
                            ]
                        }
                    }
                ],
                "ipAddress": {
                    "ports": [
                        {
                            "protocol": "TCP",
                            "port": 80
                        }
                    ],
                    "ip": "13.95.1.0",
                    "type": "Public",
                    "dnsNameLabel": "aciwordpresstest"
                },
                "osType": "Linux",
                "volumes": [
                    {
                        "name": "wordpressfile",
                        "azureFile": {
                            "shareName": "wordpress-share",
                            "storageAccountName": "acistoragetest1"
                        }
                    },
                    {
                        "name": "mysqlfile",
                        "azureFile": {
                            "shareName": "mysql-share",
                            "storageAccountName": "acistoragetest1"
                        }
                    }
                ]
            },
            "dependsOn": []
        },
        {
            "type": "Microsoft.Network/virtualNetworks",
            "name": "[parameters('virtualNetworks_aci_test_name')]",
            "apiVersion": "2018-02-01",
            "location": "[parameters('location')]",
            "properties": {
                "addressSpace": {
                    "addressPrefixes": [
                        "10.0.0.0/16"
                    ]
                },
                "subnets": [
                    {
                        "name": "app-subnet",
                        "properties": {
                            "addressPrefix": "10.0.0.0/24"
                        }
                    }
                ],
                "virtualNetworkPeerings": [],
                "enableDdosProtection": false,
                "enableVmProtection": false
            },
            "dependsOn": []
        },
        {
            "type": "Microsoft.Storage/storageAccounts",
            "sku": {
                "name": "Standard_LRS",
                "tier": "Standard"
            },
            "kind": "StorageV2",
            "name": "[parameters('storageAccounts_acistoragetest_name')]",
            "apiVersion": "2018-07-01",
            "location": "[parameters('location')]",
            "tags": {},
            "scale": null,
            "properties": {
                "networkAcls": {
                    "bypass": "AzureServices",
                    "virtualNetworkRules": [],
                    "ipRules": [],
                    "defaultAction": "Allow"
                },
                "supportsHttpsTrafficOnly": true,
                "accessTier": "Hot"
            },
            "dependsOn": []
        },
        {
            "type": "Microsoft.Storage/storageAccounts",
            "sku": {
                "name": "Standard_LRS",
                "tier": "Standard"
            },
            "kind": "Storage",
            "name": "[parameters('storageAccounts_acistoragetest1_name')]",
            "apiVersion": "2018-07-01",
            "location": "[parameters('location')]",
            "tags": {},
            "scale": null,
            "properties": {
                "networkAcls": {
                    "bypass": "AzureServices",
                    "virtualNetworkRules": [],
                    "ipRules": [],
                    "defaultAction": "Allow"
                },
                "supportsHttpsTrafficOnly": false
            },
            "dependsOn": []
        },
        {
            "type": "Microsoft.Network/virtualNetworks/subnets",
            "name": "[concat(parameters('virtualNetworks_aci_test_name'), '/', parameters('subnets_app_subnet_name'))]",
            "apiVersion": "2018-02-01",
            "scale": null,
            "properties": {
                "addressPrefix": "10.0.0.0/24"
            },
            "dependsOn": [
                "[resourceId('Microsoft.Network/virtualNetworks', parameters('virtualNetworks_aci_test_name'))]"
            ]
        }
    ]
}